---
title: "p8105_hw5_yw3439"
author: "Qetsiyah Wang"
date: "11/15/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

library(tidyverse)
library(dplyr)
```

# Problem 1 - Washington Homicides

```{r}
homicide = read_csv("homicide-data.csv")
```
  The raw dataset contains `r ncol(homicide)` variables and `r nrow(homicide)` observations. Major variables contain: information about victims in each homicide, including their names, `r str_remove(colnames(homicide)[5:7], pattern = "victim_")`, and reported case information, such as `r colnames(homicide)[8:12]` and `r colnames(homicide)[2]`. 

```{r}

cases = homicide %>%
  mutate(
    city_state = paste(city, ",", state)
  ) %>%
  select(-city, -state) %>%
  group_by(city_state, disposition) %>%
  summarize(n = n()) %>%
  pivot_wider(
    names_from = disposition,
    values_from = n
  ) %>%
  janitor::clean_names() %>%
  mutate(
    total_cases = sum(closed_by_arrest, closed_without_arrest, open_no_arrest, na.rm = TRUE),
    unsolved_cases = sum(closed_without_arrest, open_no_arrest, na.rm = TRUE)
  ) %>%
  select(-closed_by_arrest, -closed_without_arrest, -open_no_arrest)

```
knitr::kable(cases)

```{r}

baltimore = cases %>%
  filter(city_state == "Baltimore , MD") %>%
  as.list()

baltimore_prop = prop.test(x = baltimore[["unsolved_cases"]], n = baltimore[["total_cases"]]) %>%
  broom::tidy() %>%
  select(estimate, conf.low, conf.high)
  
```
  With proportion test of homicide cases in Baltimore, MD, the estimate proportion is `r round(pull(baltimore_prop, estimate), 2)` and the confidence level for the test is (`r round(pull(baltimore_prop, conf.low, 2))`, `r round(pull(baltimore_prop, conf.high, 2))`).
  
```{r}

propor = function(unsolved, total) {
  
  prop.test(x = unsolved, n = total) %>%
    broom::tidy() %>%
    select(estimate, conf.low, conf.high)
}

cases_test = cases[2:3]
  
  
cases_test = cases_test %>%
  mutate(
    output = map2(.x = cases_test$unsolved_cases, .y = cases_test$total_cases, ~ propor(unsolved = .x, total = .y)),
    result = map(output, bind_rows)
  ) %>%
  select(-output) %>%
  unnest(result)

cases_test = cases_test %>%
  mutate(
    city_state = pull(cases, city_state)
  ) %>%
  select(city_state, estimate, conf.low, conf.high)

```
knitr::kable(cases_test)

  Proportion test for each cities about unsolved homicide cases are shown in the table above.

```{r}


```

# Probelm 2

```{r}

file = list.files("./data/", recursive= TRUE, full.names = TRUE) 

study = purrr::map(file, ~ read.csv(.)) %>%
  reduce(rbind) %>%
  

```





