---
title: "p8105_hw5_yw3439"
author: "Qetsiyah Wang"
date: "11/15/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

library(tidyverse)
library(dplyr)
```

# Problem 1 - Washington Homicides

```{r}
homicide = read_csv("homicide-data.csv")
```
  The raw dataset contains `r ncol(homicide)` variables and `r nrow(homicide)` observations. Major variables contain: information about victims in each homicide, including their names, `r str_remove(colnames(homicide)[5:7], pattern = "victim_")`, and reported case information, such as `r colnames(homicide)[8:12]` and `r colnames(homicide)[2]`. 

```{r}

cases = homicide %>%
  mutate(
    city_state = paste(city, ",", state)
  ) %>%
  select(-city, -state) %>%
  group_by(city_state, disposition) %>%
  summarize(n = n()) %>%
  pivot_wider(
    names_from = disposition,
    values_from = n
  ) %>%
  janitor::clean_names() %>%
  mutate(
    total_cases = sum(closed_by_arrest, closed_without_arrest, open_no_arrest, na.rm = TRUE),
    unsolved_cases = sum(closed_without_arrest, open_no_arrest, na.rm = TRUE)
  ) %>%
  select(-closed_by_arrest, -closed_without_arrest, -open_no_arrest)

```
knitr::kable(cases)

```{r}

baltimore = cases %>%
  filter(city_state == "Baltimore , MD") %>%
  as.list()

baltimore_prop = prop.test(x = baltimore[["unsolved_cases"]], n = baltimore[["total_cases"]]) %>%
  broom::tidy() %>%
  select(estimate, conf.low, conf.high)
  
```
  With proportion test of homicide cases in Baltimore, MD, the estimate proportion is `r round(pull(baltimore_prop, estimate), 2)` and the confidence level for the test is (`r round(pull(baltimore_prop, conf.low, 2))`, `r round(pull(baltimore_prop, conf.high, 2))`).
  
```{r}

propor = function(unsolved, total) {
  
  prop.test(x = unsolved, n = total) %>%
    broom::tidy() %>%
    select(estimate, conf.low, conf.high)
}

cases_test = cases[2:3]
  
  
cases_test = cases_test %>%
  mutate(
    output = map2(.x = cases_test$unsolved_cases, .y = cases_test$total_cases, ~ propor(unsolved = .x, total = .y)),
    result = map(output, bind_rows)
  ) %>%
  select(-output) %>%
  unnest(result)

cases_test = cases_test %>%
  mutate(
    city_state = pull(cases, city_state)
  ) %>%
  select(city_state, estimate, conf.low, conf.high)

```
knitr::kable(cases_test)

  Proportion test for each cities about unsolved homicide cases are shown in the table above.

```{r}


```

# Probelm 2

```{r}

file = list.files("./data/", recursive= TRUE, full.names = TRUE) 

study = purrr::map(file, ~ read.csv(.)) %>%
  reduce(rbind) %>%
  mutate(
    subject_id = rep(c(1:10),2)
  ) %>%
  arrange(subject_id) %>%
  mutate(
    arm = rep(c("control", "experiment"), 10))

study %>%
  pivot_longer(
    week_1 : week_8,
    names_to = "week",
    values_to = "observations",
    names_prefix = "week_"
  ) %>%
  mutate(
    week = as.numeric(week),
    subject_id = as.factor(subject_id)
  ) %>%
  ggplot(aes(x = week, y = observations, color = subject_id)) +
  geom_line() +
  facet_grid(~arm) +
  labs(
    title = "Observations on each subject over time within Control and Experimental group",
    x = "Week",
    y = "Observations"
  )

```
  The control group, showing fluctuations within certain range during 8 weeks, represented the overall flat trend with tiny differences between starting and ending observations. For example, subject_5 in the control group showed the difference between the start and end of `n study$week8[5]-study$week1[5]`. Unlike the control group, the experimental group represented the overall significantly increasing trend in observations across the period of 8 weeks. Subject_5 in the experimental group showed the difference across the experiment period of `n study$week8[15]-study$week1[15]` Especially within the first 2 weeks, all subjects in the experimental group showed very steep slopes. Overall comparison indicated the exposure in this longitudinal study did have efficacy on subjects.
  
```{r}



```




